---
title: Файловая система
---

## Вопросы
### Что такое файл в понятиях Unix-like операцинных системах?

Файлы - это объекты, в которые мы записываем информацию и наши данные, исполняемые файлы, но кроме этих привычных нам понятий здесь есть файлы специального назначения - файлы устройств, файлы туннелей, сокетов и многое другое.

Типы файлов в Linux:

- Обычные файлы, для хранения информации;
- Специальные файлы - для устройств и туннелей;
- Директории.

### Где хранятся имена файлов/директорий?

В Unix имена файлов и директорий хранятся в **каталогах** — это специальные файлы, где каждая запись содержит имя и ссылку на **inode**. Сам inode хранит уже метаданные (размер, права, владельца, временные метки и указатели на блоки данных), но **не имя**. Таким образом, имя → в каталоге, а содержимое и свойства файла → в inode и блоках данных.

### В каком файле находится информация о смонтированных каталогах в файловую систему?

Файл `/etc/fstab` содержит информацию о смонтированных каталогах в файловую систему.

### Что выведет команда `cat a` и почему?

```bash
mkdir /tmp/abc
cd /tmp/abc
ls >a 2>b
cat a
```

Обработка команды идёт справа налево. Сначала создается файл _b_, потом создается файл _a_, команда `ls` отображает список файлов в текущей директории (файлы _a_ и _b_ уже созданы) в одну колонну и перенаправляет стандартный поток вывода (`>`) в файл _a_, а стандартный поток ошибок `2` в файл _b_.

### Как удалить файл с именем `-rf`?

```bash
rm ./-rf
```

### Как посмотреть описание дескриптора?

Посмотреть полную информацию по дискриптору возможно командой
```bash
stat <path_to_file>
```

### Как посмотреть время последней модификации файла?

Можно через `stat` с нужным форматом:
```bash
stat --format=%y <file>
```

### Что такое inode? Какая информация там хранится?

Inode (индексный дескриптор) - структура данных, в которой хранятся метаданные файла и перечислены блоки с данными файла. Хранит всю информацию, кроме имени файла и данных. Каждый файл в данном каталоге является записью с именем файла и номером индекса. Вся остальная информация о файле извлекается из таблицы индексов путем ссылки на номер индекса. Номера inodes уникальны на уровне раздела. Каждый раздел как собственная таблица индексов. Если у вас закончились inode, вы не можете создавать новые файлы, даже если у вас есть свободное место на данном разделе.

Inodes хранит метаданные о файле, к которому он относится. Эти метаданные содержат всю информацию об указанном файле.

- Размер.
- Разрешение.
- Владелец/группа.
- Расположение жесткого диска.
- Дата/время.
- Любая другая необходимая информация.

### Что такое hard link? В чем разница между hard link и soft link? Примеры.

**Hard link**:
Ссылка на файл в файловой системе с использованием такого же inode идентификатора, как у файла, на который ссылаемся.
Создадим файл _realFile_.

```
touch realFile
```

Создадим hard link командой `ln <целевой_файл> <файл_ссылка>`:

```
ln realFile hardLink
```

Проверим, что inode у файла _realFile_ и hard ссылке _hardLink_ имеют одинаковый идентификатор.

```
$ ls -li
итого 0
2359720 -rw-r--r-- 2 rmntrvn rmntrvn 0 апр 25 23:24 hardLink
2359720 -rw-r--r-- 2 rmntrvn rmntrvn 0 апр 25 23:24 realFile
```

Как видно realFile и hardLink имеют одинаковый идентификатор inode.

**Soft link**:
Создадим soft ссылку на файл _realFile_.

```
ln -s realFile softLink
```

Проверим, что числовой идентификатор _softLink_ отличается от числового идентификатора _realFile_.

```
$ ls -li
итого 0
2359720 -rw-r--r-- 2 rmntrvn rmntrvn 0 апр 25 23:24 hardLink
2359720 -rw-r--r-- 2 rmntrvn rmntrvn 0 апр 25 23:24 realFile
2366763 lrwxrwxrwx 1 rmntrvn rmntrvn 8 апр 25 23:29 softLink -> realFile
```

Некоторые нюансы:
- Soft ссылки используют различные номера inode, чем основные файлы.
- Soft ссылки становятся полезными, если исходный файл был удален.
- Soft ссылки могут быть созданы из каталогов.
- Soft ссылка может быть создана на пересечении файловых систем.

- Hard ссылка может размещаться только на том же логическом разделе, что и оригинальный файл. Это связано с независимой идентификацией файлов на разных разделах.
- Создание жестких ссылок не поддерживается для папок — только для файлов.
- Файловая система должна поддерживать работу с hard ссылками.

### Что такое файловый дескриптор, что там хранится?

_Файловый дескриптор_ - неотрицательное целое число, которое используется в интерфейсе между пространством пользователя и пространством ядра (kernel) для идентификации ресурсов файла / сокета. Когда создаётся новый поток ввода-вывода, ядро возвращает процессу, создавшему поток ввода-вывода, его файловый дескриптор.
